toolsets:
  ig/core:
    description: "Set of tools and framework for data collection and system inspection on Kubernetes clusters"
    llm_instructions: |
      You have access to a set of tools for inspecting the networking issue inside the Kubernetes clusters. To use this toolset, you need to install the `inspect_gadget` with tool `install_inspect_gadget`.
      For DNS tracing with `trace_dns_gadget`:
        1. Identify the `pod_name` and `namespace` for the network capture.
        2. If you need to trace DNS queries and responses, use the `trace_dns_gadget`.
        3. Specify a `timeout` (in seconds) for how long the capture should run, to get enough enough data to analyze, default is 30 seconds unless there's a customer-specified one.
        4. Example command for `trace_dns_gadget`:
           `kubectl gadget run trace_dns:latest --podname {{pod_name}} --namespace {{namespace}} --timeout {{timeout}} --fields src,dst,name,qr,qtype,rcode_raw --output json`
           (Remember to replace `{{pod_name}}`, `{{namespace}}`, and `{{timeout}}` with actual values if you are constructing the command manually for the user. If you are calling the tool directly, provide these as parameters.)
        5. Examine the JSON output, paying attention to `src`(where the dns packet is sent), `dst`(where the dns packet is received), `name` (queried domain), `qr` (query/response), `qtype` (DNS record type), and `rcode_raw` (response code) to understand DNS behavior.
          5.1 You can use src, dst and name to link the DNS queries and responses.
          5.2 A valid in-cluster FQDN should be in the format <service-name>.<service-namespace>.svc.cluster.local. Ignore any DNS requests that end with svc.cluster.local but do not match this pattern, as they are not valid in-cluster service FQDNs.
          5.3 If there's dns query and no response, it means the DNS server is not reachable for network issue or the DNS server is not responding.
      DO NOT tell the user to check if a resource exists or to update the configuration without being specific, DO checks yourself on behalf of the user and then tell them the solution.
    tags:
      - cli
    prerequisites:
      - command: "kubectl gadget version"
    tools:
      - name: "trace_dns_gadget"
        description: " top_tcp gadget trace DNS queries and responses of a Kubernetes pod for number of seconds"
        user_description: "fetch DNS queries and responses of pod {{namespace}}/{{pod_name}} for {{timeout}} seconds"
        command: |
          kubectl gadget run trace_dns:latest --podname {{pod_name}} --namespace {{namespace}} --timeout {{timeout}} --fields src,dst,name,qr,qtype,rcode_raw --output json
